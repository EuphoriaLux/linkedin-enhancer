window.addEventListener("message",(async e=>{if(e.origin!==window.location.origin)return;const{action:t,feedUrl:r}=e.data;if("fetchRSSFeed"===t)try{const t=await fetch(r);if(!t.ok)throw new Error(`Network response was not ok: ${t.statusText}`);const o=await t.text(),n=(new DOMParser).parseFromString(o,"application/xml");if(n.querySelector("parsererror"))throw new Error("Error parsing RSS feed.");const i=n.querySelector("channel > title")?.textContent||"No Title";let s=n.querySelector("channel > image > url")?.textContent||null;if(s&&!/^https?:\/\//i.test(s)){const e=new URL(r).origin;s=new URL(s,e).href}const c=Array.from(n.querySelectorAll("item")).map((e=>{let t=e.querySelector("media\\:content, content\\:media, enclosure[url][type^='image/']")?.getAttribute("url")||e.querySelector("description img")?.getAttribute("src")||null;if(!t){const r=(e.querySelector("description")?.textContent||"").match(/<img[^>]+src="([^">]+)"/);t=r?r[1]:null}if(t&&!/^https?:\/\//i.test(t)){const e=new URL(r).origin;t=new URL(t,e).href}return{title:e.querySelector("title")?.textContent||"No Title",link:e.querySelector("link")?.textContent||"",description:e.querySelector("description")?.textContent||"",pubDate:e.querySelector("pubDate")?.textContent||"",image:t}})),l={title:i,url:r,image:s,items:c};console.log("üì• Feed Data:",l),e.source.postMessage({action:"rssFeedData",feed:l},e.origin)}catch(t){console.error("‚ùå Error fetching RSS feed:",t),e.source.postMessage({action:"rssFeedError",error:t.message},e.origin)}}));